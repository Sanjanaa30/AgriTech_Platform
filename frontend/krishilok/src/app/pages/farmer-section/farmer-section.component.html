<div *ngIf="section === 'my-crops'" class="p-6 text-gray-800">
    <!-- Header + Filter + Sort -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <!-- Add Crop Button -->
        <button (click)="openAddCropModal()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded"> Add
            Crop </button>

        <!-- Add/Edit Crop Modal -->
        <div *ngIf="showAddCropModal"
            class="fixed inset-0 z-50 bg-black bg-opacity-40 flex justify-center items-center">
            <div class="bg-white w-[95%] md:w-[600px] max-h-[90vh] overflow-y-auto p-6 rounded-lg shadow-xl relative">

                <!-- Header -->
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        {{ isEditing ? '‚úèÔ∏è Edit Crop' : 'üå± Add New Crop' }}
                    </h2>
                    <button (click)="closeAddCropModal()"
                        class="text-xl text-purple-500 hover:text-purple-700">‚úñ</button>
                </div>

                <!-- Form Fields -->
                <div class="space-y-4">
                    <!-- Category -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üìÇ Category *</label>
                        <select [(ngModel)]="newCrop.category" class="w-full mt-1 p-2 border rounded"
                            (change)="onCategoryChange()">
                            <option value="">Select Category</option>
                            <option *ngFor="let cat of categories">{{ cat }}</option>
                        </select>
                    </div>

                    <!-- Crop Name -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üåæ Crop Name *</label>
                        <select [(ngModel)]="newCrop.name" class="w-full mt-1 p-2 border rounded"
                            (change)="onCropChange()">
                            <option value="">Select Crop</option>
                            <option *ngFor="let crop of cropOptions">{{ crop.NAME }}</option>
                        </select>
                    </div>

                    <!-- Season -->
                    <div *ngIf="seasonBadge" class="mt-1">
                        <span class="inline-block bg-green-100 text-green-700 text-xs font-medium px-2 py-1 rounded">
                            üè∑Ô∏è {{ seasonBadge }}
                        </span>
                    </div>

                    <!-- Variety -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üî§ Variety</label>
                        <select class="w-full mt-1 p-2 border rounded" [(ngModel)]="newCrop.variety">
                            <option value="">Select or type manually</option>
                            <option *ngFor="let v of varietyOptions">{{ v }}</option>
                        </select>
                        <input *ngIf="!varietyOptions.length" type="text" class="w-full mt-2 p-2 border rounded"
                            [(ngModel)]="newCrop.variety" placeholder="e.g., Roma, Basmati 1121" />
                    </div>

                    <!-- Dates -->
                    <div class="flex flex-col md:flex-row md:space-x-4">
                        <div class="flex-1">
                            <label class="text-sm font-medium text-gray-700">üìÖ Sowing Date *</label>
                            <input type="date" class="w-full mt-1 p-2 border rounded"
                                [(ngModel)]="newCrop.sowingDate" />
                        </div>
                        <div class="flex-1 mt-4 md:mt-0">
                            <label class="text-sm font-medium text-gray-700">üìÜ Expected Harvest *</label>
                            <input type="date" class="w-full mt-1 p-2 border rounded"
                                [(ngModel)]="newCrop.harvestDate" />
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div>
                        <label class="text-sm font-medium text-gray-700 mb-2">Upload Photos</label>
                        <div class="w-full border-2 border-dashed border-gray-300 rounded-md p-6 text-center cursor-pointer bg-gray-50 hover:border-green-500 transition"
                            (drop)="onDrop($event)" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
                            [class.border-green-500]="isDragOver" (click)="imageInputRef.nativeElement.click()">
                            <div class="flex flex-col items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M4 12l1.41-1.41M12 4v8m0 0l-3.59-3.59M12 12l3.59-3.59" />
                                </svg>
                                <p class="font-semibold text-gray-700">Upload a File</p>
                                <p class="text-sm text-gray-500">Drag and drop files here</p>
                            </div>
                            <input #imageInput type="file" (change)="onImageSelected($event)" accept="image/*" hidden />

                        </div>

                        <!-- Preview -->
                        <div *ngIf="imagePreview" class="mt-4 text-center">
                            <img [src]="imagePreview" class="mx-auto max-h-40 rounded shadow" />
                            <button type="button" (click)="clearImage()"
                                class="mt-2 text-sm text-red-600 hover:underline">‚úñ Remove Image</button>
                        </div>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">‚öôÔ∏è Status *</label>
                        <select [(ngModel)]="newCrop.status" class="w-full mt-1 p-2 border rounded">
                            <option value="">Select Status</option>
                            <option>Sowing</option>
                            <option>Growing</option>
                            <option>Harvesting</option>
                            <option>Ready for Market</option>
                            <option>Diseased</option>
                            <option>Irrigation Needed</option>
                        </select>
                    </div>

                    <!-- Area -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üìê Area (acres)</label>
                        <input type="number" class="w-full mt-1 p-2 border rounded" [(ngModel)]="newCrop.area" />
                    </div>

                    <!-- Irrigation Type -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üíß Irrigation Type</label>
                        <select [(ngModel)]="newCrop.irrigationType" class="w-full mt-1 p-2 border rounded">
                            <option value="">Select Type</option>
                            <option>Drip</option>
                            <option>Sprinkler</option>
                            <option>Flood</option>
                        </select>
                    </div>

                    <!-- Last Activity -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üóíÔ∏è Last Activity</label>
                        <input type="text" class="w-full mt-1 p-2 border rounded" [(ngModel)]="newCrop.lastActivity"
                            placeholder="e.g., Fertilizer applied" />
                    </div>

                    <!-- Notes -->
                    <div>
                        <label class="text-sm font-medium text-gray-700">üßæ Notes History</label>
                        <textarea rows="3" class="w-full mt-1 p-2 border rounded" [(ngModel)]="newCrop.notes"
                            placeholder="Write notes..."></textarea>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="mt-6 text-right">
                    <button (click)="saveNewCrop()"
                        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                        ‚úÖ {{ isEditing ? 'Update' : 'Save' }} Crop
                    </button>
                </div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto">
            <!-- Filter by Status -->
            <div class="relative w-full sm:w-48">
                <select [(ngModel)]="filterStatus"
                    class="w-full appearance-none border border-gray-300 text-sm px-3 py-2 pr-8 rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option value="">Filter by Status</option>
                    <option value="Sowing">Sowing</option>
                    <option value="Growing">Growing</option>
                    <option value="Harvesting">Harvesting</option>
                    <option value="Ready for Market">Ready for Market</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>

            <!-- Sort By -->
            <div class="relative w-full sm:w-48">
                <select [(ngModel)]="sortBy"
                    class="w-full appearance-none border border-gray-300 text-sm px-3 py-2 pr-8 rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option value="">Sort by</option>
                    <option value="name">Name</option>
                    <option value="sowingDate">Sowing Date</option>
                    <option value="harvestDate">Harvest Date</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>
        </div>



    </div>

    <!-- Crop Cards -->
    <div *ngFor="let crop of filteredCrops">
        <app-crop-card [crop]="crop" (edit)="editCrop($event)" (statusUpdate)="updateCropStatus($event)"
            (viewMore)="viewMoreDetails($event)" (delete)="deleteCrop($event)">
        </app-crop-card>
    </div>
</div>

<div *ngIf="section === 'field-images'" class="p-6 text-gray-800">
    <!-- Header + Upload + Filter -->
    <app-field-section-card [fieldImages]="fieldImages" (view)="viewFieldImage($event)"
        (delete)="deleteFieldImage($event)">
    </app-field-section-card>

</div>

<div *ngIf="section === 'ai-insights'">
    <!-- AI Insights content -->
</div>

<div *ngIf="section === 'marketplace'">
    <!-- Marketplace content -->
</div>